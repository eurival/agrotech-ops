apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  project: agrotech-project
  name: mqtt-source-agro
  namespace: agrotech
  labels:
    strimzi.io/cluster: agro-connect
spec:
  class: io.lenses.streamreactor.connect.mqtt.source.MqttSourceConnector
  tasksMax: 1
  config:
    # --- ConexÃ£o MQTT ---
    connect.mqtt.hosts: "tcp://mosquitto-svc:1883"
    connect.mqtt.service.quality: "1"
    connect.mqtt.clean: "true"
    connect.mqtt.timeout: "1000"
    
    # --- O Mapeamento (KCQL) CORRIGIDO ---
    # Regra 1: sensores/+/telemetria -> telemetria-raw
    # Regra 2: onboarding/novo       -> onboarding-raw
    connect.mqtt.kcql: "INSERT INTO telemetria-raw SELECT * FROM sensores/+/telemetria; INSERT INTO onboarding-raw SELECT * FROM onboarding/novo"
    
    # --- Conversores ---
    key.converter: "org.apache.kafka.connect.storage.StringConverter"
    value.converter: "org.apache.kafka.connect.converters.ByteArrayConverter"
    
    errors.log.enable: "true"
    errors.log.include.messages: "true"

---
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: onboarding-raw
  namespace: agrotech
  labels:
    strimzi.io/cluster: agro-cluster
spec:
  partitions: 1
  replicas: 1
  config:
    retention.ms: 604800000