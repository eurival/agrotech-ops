apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: mqtt-source-agro
  namespace: agrotech
  labels:
    strimzi.io/cluster: agro-connect
spec:
  class: io.lenses.streamreactor.connect.mqtt.source.MqttSourceConnector
  tasksMax: 1
  config:
    # --- ConexÃ£o MQTT ---
    connect.mqtt.hosts: "tcp://mosquitto-svc:1883"
    connect.mqtt.service.quality: "1"
    connect.mqtt.clean: "true"
    connect.mqtt.timeout: "1000"
    
    # --- O Mapeamento (KCQL) COMPLETO ---
    # Regra 1: sensores/+/telemetria -> telemetria-raw (Dados do Sensor)
    # Regra 2: onboarding/novo       -> onboarding-raw (Sensor sem dono)
    # Regra 3: comandos/#            -> comandos-raw   (REGISTRAR;) <--- ADICIONADO AGORA
    connect.mqtt.kcql: "INSERT INTO telemetria-raw SELECT * FROM sensores/+/telemetria; INSERT INTO onboarding-raw SELECT * FROM onboarding/novo; INSERT INTO comandos-raw SELECT * FROM comandos/#"
    
    # --- Conversores ---
    # Usamos ByteArray para o valor para garantir que o JSON chegue intacto
    key.converter: "org.apache.kafka.connect.storage.StringConverter"
    value.converter: "org.apache.kafka.connect.converters.ByteArrayConverter"
    
    # --- Logs para Debug ---
    errors.log.enable: "true"
    errors.log.include.messages: "true"